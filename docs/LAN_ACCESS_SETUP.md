# 局域网访问设置指南

## 问题描述

当使用局域网地址（如 `http://192.168.1.100:5173`）访问应用时，会出现"未授权"错误，而使用本地地址（`http://localhost:5173`）则正常工作。

## 问题原因

这个问题是由于Supabase的安全配置导致的。Supabase默认只允许在项目设置中配置的域名进行认证，局域网IP地址不在允许列表中。

## 解决方案

### 方案1：在Supabase项目设置中添加局域网IP（推荐）

1. **登录Supabase控制台**
   - 访问 [https://supabase.com/dashboard](https://supabase.com/dashboard)
   - 选择你的项目

2. **进入认证设置**
   - 点击左侧菜单的 "Authentication"
   - 选择 "URL Configuration"

3. **添加允许的域名**
   - 在 "Site URL" 中添加你的局域网地址
   - 例如：`http://192.168.1.100:5173`
   - 在 "Redirect URLs" 中也添加相同的地址
   - 点击 "Save" 保存设置

4. **重启开发服务器**
   ```bash
   npm run dev -- --host 0.0.0.0
   ```

### 方案2：使用环境变量配置

1. **创建或编辑 `.env` 文件**
   ```bash
   # 添加局域网访问配置
   PUBLIC_APP_URL=http://192.168.1.100:5173
   ```

2. **启动开发服务器时指定主机**
   ```bash
   npm run dev -- --host 0.0.0.0
   ```

### 方案3：使用代理服务器

如果无法修改Supabase设置，可以使用代理服务器：

1. **安装代理工具**
   ```bash
   npm install -g localtunnel
   ```

2. **启动代理**
   ```bash
   # 先启动应用
   npm run dev
   
   # 在另一个终端启动代理
   npx localtunnel --port 5173
   ```

3. **使用代理地址访问**
   - 代理会提供一个公网地址，如：`https://abc123.loca.lt`
   - 在Supabase设置中添加这个地址

## 开发环境配置

### 启动开发服务器支持局域网访问

```bash
# 方法1：使用 --host 参数
npm run dev -- --host 0.0.0.0

# 方法2：修改 package.json
{
  "scripts": {
    "dev": "vite dev --host 0.0.0.0"
  }
}
```

### 获取局域网IP地址

```bash
# macOS/Linux
ifconfig | grep "inet " | grep -v 127.0.0.1

# Windows
ipconfig | findstr "IPv4"
```

## 安全注意事项

1. **仅用于开发环境**
   - 局域网访问主要用于开发和测试
   - 生产环境应使用HTTPS和域名

2. **防火墙设置**
   - 确保防火墙允许5173端口访问
   - 仅在可信的局域网中使用

3. **Supabase安全**
   - 定期检查Supabase项目设置
   - 移除不再使用的域名

## 故障排除

### 常见问题

1. **仍然显示未授权**
   - 检查Supabase项目设置中的域名配置
   - 确认域名格式正确（包含协议和端口）
   - 清除浏览器缓存和Cookie

2. **无法访问局域网地址**
   - 检查防火墙设置
   - 确认开发服务器使用了 `--host 0.0.0.0`
   - 验证IP地址是否正确

3. **认证状态丢失**
   - 清除浏览器存储的认证信息
   - 重新登录

### 调试步骤

1. **检查网络连接**
   ```bash
   ping 192.168.1.100
   ```

2. **检查端口是否开放**
   ```bash
   telnet 192.168.1.100 5173
   ```

3. **查看浏览器控制台**
   - 打开开发者工具
   - 查看Network和Console标签页的错误信息

## 总结

要解决局域网访问的认证问题，主要需要：

1. ✅ 在Supabase项目设置中添加局域网IP地址
2. ✅ 使用 `--host 0.0.0.0` 启动开发服务器
3. ✅ 确保防火墙允许相应端口访问
4. ✅ 清除浏览器缓存并重新测试

这样配置后，你就可以在局域网中的任何设备上正常使用应用的认证功能了。 